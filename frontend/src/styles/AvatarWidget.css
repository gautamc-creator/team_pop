/* --- CONTAINER --- */
.avatar-widget {
  position: fixed;
  bottom: 24px;
  right: 24px;
  /* Revert to simple containment for the Orb */
  display: flex;
  flex-direction: column;
  align-items: flex-end; 
  z-index: 9999;
  font-family: 'Space Grotesk', sans-serif;
  pointer-events: none;
  /* Ensure container doesn't take full screen, just where content is */
  width: auto;
  height: auto;
}

.avatar-widget.preview {
  position: relative;
  bottom: auto;
  right: auto;
  margin: 10px 0 0;
}

/* --- GLASS BUBBLE --- */
/* --- GLASS BUBBLE --- */
.bubble {
  /* Absolute position relative to the avatar-widget container */
  position: absolute;
  bottom: 100%; /* Push to top of container (above Orb) */
  right: 0;     /* Align right with Orb */
  margin-bottom: 16px; /* Space between Orb and Bubble */
  
  background: rgba(15, 24, 34, 0.72);
  border: 1px solid rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(16px);
  
  /* DEFAULT TO EXPANDED SIZE */
  width: 360px;
  max-width: 90vw;
  height: 600px;
  max-height: 80vh; 
  
  padding: 16px;
  border-radius: 18px;
  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.4);
  color: var(--text-0);
  pointer-events: auto;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  transform-origin: bottom right; /* Animate from connector */
  overflow-y: hidden;
  z-index: 10000;
}

.avatar-widget.preview .bubble {
  position: relative;
  bottom: auto;
  right: auto;
  margin: 10px 0 0;
  width: 100%;
  height: 480px;
  max-height: none;
}

/* ... headers/content ... */

/* REMOVED: .avatar-widget.mode-expanded .bubble - merged into default .bubble */

/* Note: Since we render {isOpen && ...}, the bubble is simply added/removed from DOM 
   or we can use CSS transition if we kept it in DOM. 
   React removal is cleaner for logic but no exit animation without logic. 
   User asked for simple Open/Close. 
*/

.mode-expanded .bubble::-webkit-scrollbar {
  width: 6px;
}
.mode-expanded .bubble::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 3px;
}

/* ... existing styles ... */

/* --- ORB AVATAR --- */
.orb-avatar {
  width: 84px;
  height: 84px;
  position: relative;
  pointer-events: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.5));
  transition: transform 0.2s ease;
  flex-shrink: 0; /* Prevent shrinking in flex container */
}

.orb-avatar:hover {
  transform: translateY(-2px);
}

.orb-core {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #c7f4ff, #46c2ff 45%, #0b2a3a 70%);
  box-shadow: 0 0 30px rgba(70, 194, 255, 0.45);
  position: relative;
  z-index: 2;
}

.orb-ring {
  position: absolute;
  width: 84px;
  height: 84px;
  border-radius: 50%;
  border: 1px solid rgba(109, 224, 255, 0.5);
  box-shadow: 0 0 25px rgba(109, 224, 255, 0.35);
  z-index: 1;
}

.orb-avatar.IDLE .orb-core {
  animation: breathe 3.2s ease-in-out infinite;
}

.orb-avatar.LISTENING .orb-core,
.orb-avatar.THINKING .orb-core {
  animation: pulseFast 1.1s ease-in-out infinite;
}

.orb-avatar.SPEAKING .orb-ring {
  animation: speakWave 1s ease-in-out infinite;
}

@keyframes breathe {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.04); }
}

@keyframes pulseFast {
  0%, 100% { transform: scale(1); box-shadow: 0 0 24px rgba(70, 194, 255, 0.45); }
  50% { transform: scale(1.08); box-shadow: 0 0 40px rgba(109, 224, 255, 0.65); }
}

@keyframes speakWave {
  0%, 100% { transform: scale(1); opacity: 0.6; }
  50% { transform: scale(1.08); opacity: 1; }
}

@media (max-width: 600px) {
  .avatar-widget {
    right: 16px;
    bottom: 16px;
  }
  .bubble {
    width: 220px;
  }
  .avatar-widget.mode-expanded .bubble {
    width: 90vw;
    height: 60vh;
    right: 5vw;
  }
}

/* --- CHAT HISTORY --- */
.chat-history {
  display: flex;
  flex-direction: column;
  gap: 12px;
  overflow-y: auto;
  max-height: 100%;
  padding-right: 4px; /* Space for scrollbar */
  flex: 1; /* Take remaining space */
}

/* Scrollbar within chat history */
.chat-history::-webkit-scrollbar {
  width: 4px;
}
.chat-history::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 2px;
}

.message-bubble {
  padding: 10px 14px;
  border-radius: 12px;
  max-width: 90%;
  font-size: 14px;
  line-height: 1.5;
  word-wrap: break-word; /* Ensure long words break */
  white-space: pre-wrap; /* Preserve newlines from backend */
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* User Message */
.user-message {
  align-self: flex-end;
  background: rgba(70, 194, 255, 0.15);
  color: #e9f0f6;
  border: 1px solid rgba(70, 194, 255, 0.2);
  border-bottom-right-radius: 2px;
}

/* Assistant Message */
.assistant-message {
  align-self: flex-start;
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-0);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-bottom-left-radius: 2px;
}

/* Transient States (Thinking/Listening) in chat */
.status-message {
    align-self: flex-start;
    color: var(--text-1);
    font-size: 13px;
    font-style: italic;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.typing-dot {
    width: 6px;
    height: 6px;
    background: var(--text-1);
    border-radius: 50%;
    animation: bounce 1.4s infinite ease-in-out both;
}

.typing-dot:nth-child(1) { animation-delay: -0.32s; }
.typing-dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}
